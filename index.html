<!doctype html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="viewport" content="width=device-width, height=device-height, user-scalable=yes" />
<style>
	html, body {
    margin:0;
    border: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    background-color: #3e3e3e;
    -moz-transition: all 10s ease-in;
    -webkit-transition: all 10s ease-in;
    -o-transition: all 10s ease-in;
    transition: all 10s ease-in;
       	}

	#sketch {
 	margin: 0 auto;
	}
	
	#logmessage {
				color: white;
				display: block;
				font-size: 0.9em;
				position: absolute;
				bottom: 0px;
				left: 10px;
				padding-right: 10px;
				font: "Helvetica Neue", Arial, Helvetica, sans-serif;
	}
	</style>
	
</head>
<title>Demo</title>
<body>
<canvas id="sketch" data-paper-keepalive="true" keepalive="true"></canvas>
<div id="tweets"></div> 
<script src="/socket.io/socket.io.js"></script>
<script src="http://www.jacopocolo.com/pulse/js/paper-full.min.js"></script>
<script src="http://www.jacopocolo.com/pulse/js/randomColor.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<script>
//SETUP

//GET SEARCH TERM (url/?search=SEARCHTERM)
var quiturlquery = false;
function getQueryVariable(variable)
{ if (quiturlquery == false) {

       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];
               quiturlquery = true;}
       }
       return;
       }
};
ricerca = getQueryVariable("search");

//PAPERJS SETUP
var children;

window.onload = function() {
var canvas = document.getElementById('sketch');
//SET BACKGROUND COLOR
function refreshData()
{x = 10;
document.body.style.backgroundColor=randomColor({luminosity: 'dark',hue: 'monochrome'});    
setTimeout(refreshData, x*1000);
}
refreshData()
//SET CANVAS SIZE
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
paper.setup(canvas);

var halfx = window.innerWidth/2;
var halfy = window.innerHeight/2;
var velocita = canvas.height/400;
var limite;

calclimite = function() {
	if (window.innerHeight >= window.innerWidth){
		limite = window.innerHeight/2;
		console.log(limite);
		} else {
			limite = window.innerWidth/2;
			console.log(limite);
			};
	};
calclimite();	

//jangoFett, father of all the clones
var jangofett = new paper.Shape.Circle({
    center: [halfx, halfy],
    radius: 10
});

children = paper.project.activeLayer.children;

paper.view.onFrame = function(event) {

for (var i = 1; i < children.length; i++) {
	children[i].radius += velocita;
	if (children[i].radius >= limite) {
		children[i].remove();
		console.log("ELIMINATO");
		}
	}

paper.view.draw();
};

//SOCKET.IO
var socket = io.connect('/'),
  
  tweets = document.getElementById('tweets');
  socket.on('tweet', function (data, data_followers, datacolore) {
  //  tweets.innerHTML = tweets.innerHTML + '<br>' + data;
    console.log(data);
    drawLine(data_followers, datacolore);
    $('#logmessage').text(data);
    });
  
  socket.on('connect', function(){
                      socket.emit('search', ricerca);
                  });
                  
  socket.on('connected', function() {
  console.log('connesso');
  $('body').append("<p id=\"logmessage\">Waiting for the first tweet…</p>");
  });

//PAPER.JS AGAIN — This function draws the circles              
function drawLine(followers, color) {
	
	var spessore;

	if (followers < 10) {
	spessore = 0.5
	} else if (followers > 10 && followers <= 100) {
	spessore = 1
	} else if (followers > 100 && followers <= 1000) {
	spessore = 2
	} else if (followers > 1000 && followers <= 10000) {
	spessore = 4
	} else if (followers > 10000 && followers <= 100000) {
	spessore = 6
	} else if (followers > 1000000) {spessore = 8};
	 	
 	//all the stormstroopers are Jango's clones
 	var stormtrooper = jangofett.clone();

 	stormtrooper.strokeColor = randomColor({luminosity: 'light'});
 	stormtrooper.strokeWidth = spessore;
 	
	};
	
	paper.view.draw();
};
</script>
</body>